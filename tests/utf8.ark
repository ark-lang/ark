#use std::io
#use std::mem
#use std::unicode::utf8

test_strings := []string{
    "hello",
    "Test string 1234\n",
    "ã“ã‚“ã«ã¡ã¯",
    "æ±äº¬",
    "ä½ å¥½",
    "weiÃŸ",
    "ĞĞ‚ĞƒĞ„Ğ…Ğ†Ğ‡ĞˆĞ‰ĞŠĞ‹ĞŒĞĞĞĞĞ‘Ğ’Ğ“Ğ”Ğ•Ğ–Ğ—Ğ˜Ğ™ĞšĞ›ĞœĞĞĞŸĞ Ğ¡Ğ¢Ğ£Ğ¤Ğ¥Ğ¦Ğ§Ğ¨Ğ©ĞªĞ«Ğ¬Ğ­Ğ®Ğ¯Ğ°Ğ±Ğ²Ğ³Ğ´ĞµĞ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑÑ",
    "â¤ï¸ ğŸ’” ğŸ’Œ ğŸ’• ğŸ’ ğŸ’“ ğŸ’— ğŸ’– ğŸ’˜ ğŸ’ ğŸ’Ÿ ğŸ’œ ğŸ’› ğŸ’š ğŸ’™",
    "1;DROP TABLE users",
    "ìš¸ë€ë°”í† ë¥´",
    "ï¾Ÿï½¥âœ¿ãƒ¾â•²(ï½¡â—•â€¿â—•ï½¡)â•±âœ¿ï½¥ï¾Ÿ",
};

test_string_num_runes := []uint{
    5,
    17,
    5,
    2,
    2,
    4,
    79,
    30,
    18,
    5,
    16,
};

pub func main() -> int {
    mut i: uint = 0;
    for i < len(test_strings) {

        num_runes := utf8::num_runes([]u8(test_strings[i]));
        if num_runes != test_string_num_runes[i] {
            return 1;
        }

        runeArray := mem::allocArray<rune>(num_runes);
        utf8::decode(runeArray, []u8(test_strings[i]));
        num_bytes := utf8::num_bytes(runeArray);
        if num_bytes != len(test_strings[i]) {
            return 2;
        }

        byteArray := mem::allocArray<u8>(num_bytes);
        utf8::encode(byteArray, runeArray);
        mut t: uint = 0;
        for t < num_bytes {
            if byteArray[t] != test_strings[i][t] {
                return 3;
            }
            t += 1;
        }

        i += 1;
    }

    return 0;
}
