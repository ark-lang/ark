#use std::io
#use std::mem
#use std::unicode::utf8

TEST_STRINGS := []string{
    "hello",
    "Test string 1234\n",
    "ã“ã‚“ã«ã¡ã¯",
    "æ±äº¬",
    "ä½ å¥½",
    "weiÃŸ",
    "ÐÐ‚ÐƒÐ„Ð…Ð†Ð‡ÐˆÐ‰ÐŠÐ‹ÐŒÐÐŽÐÐÐ‘Ð’Ð“Ð”Ð•Ð–Ð—Ð˜Ð™ÐšÐ›ÐœÐÐžÐŸÐ Ð¡Ð¢Ð£Ð¤Ð¥Ð¦Ð§Ð¨Ð©ÐªÐ«Ð¬Ð­Ð®Ð¯Ð°Ð±Ð²Ð³Ð´ÐµÐ¶Ð·Ð¸Ð¹ÐºÐ»Ð¼Ð½Ð¾Ð¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰ÑŠÑ‹ÑŒÑÑŽÑ",
    "â¤ï¸ ðŸ’” ðŸ’Œ ðŸ’• ðŸ’ž ðŸ’“ ðŸ’— ðŸ’– ðŸ’˜ ðŸ’ ðŸ’Ÿ ðŸ’œ ðŸ’› ðŸ’š ðŸ’™",
    "1;DROP TABLE users",
    "ìš¸ëž€ë°”í† ë¥´",
    "ï¾Ÿï½¥âœ¿ãƒ¾â•²(ï½¡â—•â€¿â—•ï½¡)â•±âœ¿ï½¥ï¾Ÿ",
};

TEST_STRING_NUM_RUNES := []uint{
    5,
    17,
    5,
    2,
    2,
    4,
    79,
    30,
    18,
    5,
    16,
};

pub func main() -> int {
    mut i: uint = 0;
    for i < len(TEST_STRINGS) {

        numRunes := utf8::numRunes([]u8(TEST_STRINGS[i]));
        if numRunes != TEST_STRING_NUM_RUNES[i] {
            return 1;
        }

        runeArray := mem::allocArray<rune>(numRunes);
        utf8::decode(runeArray, []u8(TEST_STRINGS[i]));
        numBytes := utf8::numBytes(runeArray);
        if numBytes != len(TEST_STRING_NUM_RUNES[i]) {
            return 2;
        }

        byteArray := mem::allocArray<u8>(numBytes);
        utf8::encode(byteArray, runeArray);
        mut t: uint = 0;
        for t < numBytes {
            if byteArray[t] != TEST_STRINGS[i][t] {
                return 3;
            }
            t += 1;
        }

        i += 1;
    }

    return 0;
}
